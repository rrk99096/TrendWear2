{% extends 'base.html' %}
{% block content %}

<div class="container" style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
    
    <div style="margin-bottom: 20px;">
        <a href="{% url 'inventory' %}" style="color: #666;">&larr; Back to Inventory</a>
    </div>

    <div class="form-card">
        <h2 style="margin-bottom: 25px;">Add New Product</h2>
        
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <h5 class="section-label">1. Basic Details</h5>
            <div class="row">
                <div class="group">
                    <label>Product Name</label>
                    <input type="text" name="name" required placeholder="e.g. Vintage Denim Jacket">
                </div>
                <div class="group">
                    <label>Category</label>
                    <select name="category">
                        <option value="Men">Men</option>
                        <option value="Women">Women</option>
                        <option value="Kids">Kids</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="group">
                    <label>Sub Category</label>
                    <input type="text" name="sub_category" placeholder="e.g. Jeans, Shirts">
                </div>
                <div class="group" style="display: flex; align-items: center; padding-top: 25px;">
                    <input type="checkbox" name="is_rentable" id="rentCheck" style="width: auto; transform: scale(1.3); margin-right: 10px;">
                    <label for="rentCheck" style="margin: 0; cursor: pointer;">Available for Rent? (Auto-sets price to 10%)</label>
                </div>
            </div>

            <div class="group">
                <label>Description</label>
                <textarea name="description" rows="3"></textarea>
            </div>

            <h5 class="section-label" style="margin-top: 30px;">2. Images</h5>
            <div class="row">
                <div class="group">
                    <label>Main Thumbnail</label>
                    <input type="file" name="thumbnail" accept="image/*" required>
                </div>
                <div class="group">
                    <label>Gallery Images</label>
                    <input type="file" name="images" accept="image/*" multiple>
                </div>
            </div>

            <hr class="divider">

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h5 class="section-label" style="margin: 0;">3. Variants & Pricing</h5>
                <button type="button" class="btn-outline" onclick="addVariantRow()">+ Add Another Size</button>
            </div>

            <div id="variants-container">
                <div class="variant-row">
                    <div class="v-group size-box">
                        <label>Size</label>
                        <select name="size[]" required>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>
                    <div class="v-group">
                        <label>Color</label>
                        <input type="text" name="color[]" value="Standard" required>
                    </div>
                    <div class="v-group">
                        <label>Stock</label>
                        <input type="number" name="stock[]" value="10" required>
                    </div>
                    <div class="v-group">
                        <label>Sale Price ($)</label>
                        <input type="number" name="sale_price[]" step="0.01" required placeholder="e.g. 50.00">
                    </div>
                    
                    <button type="button" class="btn-remove" onclick="removeRow(this)"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <button type="submit" class="btn-save">Save Product</button>
        </form>
    </div>
</div>

<script>
    function addVariantRow() {
        const container = document.getElementById('variants-container');
        const firstRow = container.querySelector('.variant-row');
        const newRow = firstRow.cloneNode(true);
        
        const inputs = newRow.querySelectorAll('input');
        inputs.forEach(input => {
            if(input.name.includes('color')) input.value = "Standard";
            else if(input.name.includes('stock')) input.value = "10";
            else input.value = "";
        });

        container.appendChild(newRow);
    }

    function removeRow(btn) {
        const container = document.getElementById('variants-container');
        if (container.querySelectorAll('.variant-row').length > 1) {
            btn.closest('.variant-row').remove();
        } else {
            alert("You must have at least one variant.");
        }
    }
</script>

<style>
    /* Same CSS as before */
    .form-card { background: #fff; padding: 30px; border-radius: 8px; border: 1px solid #eee; }
    .section-label { color: #888; text-transform: uppercase; font-size: 0.85rem; font-weight: bold; border-left: 4px solid #000; padding-left: 10px; margin-bottom: 20px; }
    .divider { border: 0; border-top: 1px dashed #ddd; margin: 30px 0; }
    .row { display: flex; gap: 20px; margin-bottom: 15px; }
    .group { flex: 1; }
    .group label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
    .group input, .group select, .group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
    .variant-row { display: flex; gap: 10px; align-items: flex-end; background: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 10px; border: 1px solid #eee; }
    .v-group { flex: 1; }
    .v-group label { font-size: 0.8rem; margin-bottom: 4px; display: block; color: #666; }
    .v-group input, .v-group select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .size-box { flex: 0.5; } 
    .btn-remove { background: transparent; border: none; color: #dc3545; cursor: pointer; padding: 10px; font-size: 1.1rem; }
    .btn-outline { background: transparent; border: 1px solid #000; color: #000; padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; font-weight: bold; }
    .btn-outline:hover { background: #f0f0f0; }
    .btn-save { width: 100%; background: #1a1a1a; color: #fff; padding: 15px; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
    .btn-save:hover { background: #333; }
    @media (max-width: 768px) {
        .variant-row { flex-wrap: wrap; }
        .v-group { min-width: 45%; }
    }
</style>
{% endblock %}